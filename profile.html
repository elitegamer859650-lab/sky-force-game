<div class="profile-card">
    <div style="position: relative; display: inline-block;">
        <img id="profile-img" src="assets/default-avatar.png" class="avatar">
        <input type="file" id="img-upload" style="display:none" accept="image/*">
        <label for="img-upload" style="position:absolute; bottom:15px; right:0; background:red; padding:5px; border-radius:50%; cursor:pointer; font-size:10px;">EDIT</label>
    </div>

    <h2 id="display-name" contenteditable="true" style="border-bottom: 1px dashed cyan;">Enter Name</h2>
    
    <p style="color: gold;">LEVEL: <span id="user-level">1</span></p>
    
    <div class="stat-box">
        <div><p>EXP</p><h3 id="user-exp">0</h3></div>
        <div><p>COINS</p><h3 id="user-coins">500</h3></div>
    </div>

    <button class="btn-back" id="save-profile" style="background: green;">SAVE CHANGES âš¡</button>
</div>

<script type="module">
    import { getAuth, updateProfile } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js";

    const auth = getAuth();
    const storage = getStorage();

    // 1. Image Upload Logic [cite: 2025-12-24]
    document.getElementById('img-upload').onchange = async (e) => {
        const file = e.target.files[0];
        if(!file) return;

        const storageRef = ref(storage, 'profiles/' + auth.currentUser.uid);
        await uploadBytes(storageRef, file);
        const url = await getDownloadURL(storageRef);
        document.getElementById('profile-img').src = url;
        await updateProfile(auth.currentUser, { photoURL: url });
        alert("Photo Updated! Dhayeen!");
    };

    // 2. Save Name Logic
    document.getElementById('save-profile').onclick = async () => {
        const newName = document.getElementById('display-name').innerText;
        await updateProfile(auth.currentUser, { displayName: newName });
        alert("Profile Saved, Bhai!");
    };
</script>
